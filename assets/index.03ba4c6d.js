import{c as e,a as t,b as s,d as a,u as o,r as n,o as r,e as l,f as u,w as c,g as i,h as p,N as d,i as y,j as g,k as v,l as f,m,n as w,p as k,q as h,s as x,t as S,v as _,x as b,y as q,z as I}from"./vendor.74a1cf64.js";async function F(a){const o=e(),n=await t.getBlockAttr(o,"custom-data");if(!n||""==n.value)return{success:!1,isFirst:!0};try{const e=s.exports.AES.decrypt(n.value,a).toString(s.exports.enc.Utf8),t=JSON.parse(e);return"secret-block"==t.type?{success:!0,content:t.content}:{success:!1}}catch(r){return{success:!1}}}!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const L=async(a,o)=>{const n=e(),r={type:"secret-block",content:a},l=s.exports.AES.encrypt(JSON.stringify(r),o).toString();await t.setBlockAttrs({id:n,attrs:{"custom-data":l}})},A=m("解锁"),C=a({props:{unlock:{type:Function,required:!0},lock:{type:Function,required:!0}},setup(s){const a=s,m=o(),w=n(""),k=async()=>{const e=await F(w.value);e.success?a.unlock(w.value):e.isFirst?""===w.value?m.error("密码不能为空！"):(await L("",w.value),a.unlock(w.value)):m.error("密码错误！")},h=e=>{w.value=e},x=e=>{"Enter"===e.key&&k()},S=n(!1);return r((async()=>{const s=e(),a=await t.getBlockAttr(s,"custom-data");a&&""!=a.value||(S.value=!0)})),(e,t)=>(l(),u(p(f),{"x-gap":"12",cols:"1 400:4",style:{margin:"auto",paddingLeft:"25px"}},{default:c((()=>[i(p(g),{span:"3"},{default:c((()=>[i(p(d),{"item-style":{margin:"10px",width:"100%"}},{default:c((()=>[i(p(y),{"on-update:value":h,placeholder:S.value?"请设置初始密钥":"请输入密钥",onKeyup:x,"passively-activated":"",round:"",type:"password"},null,8,["placeholder"])])),_:1})])),_:1}),i(p(g),{span:"1"},{default:c((()=>[i(p(d),{justify:"space-around","item-style":{margin:"10px"}},{default:c((()=>[i(p(v),{onClick:k,type:"primary",ghost:""},{default:c((()=>[A])),_:1})])),_:1})])),_:1})])),_:1}))}}),N={style:{position:"relative",display:"flex",flex:"1"}},T=m("密"),E=m("···"),j=a({props:{psd:{type:String,required:!0},lock:{type:Function,required:!0},changePassword:{type:Function,required:!0}},setup(e){const t=e,s=n(""),a=w.exports.debounce((()=>L(s.value,t.psd)),200),o=w.exports.throttle((()=>window.sessionStorage.setItem("sy-secret-password-time",(new Date).toUTCString())),1e3),d=e=>{s.value=e,o(),a()};r((()=>(async()=>{const e=await F(t.psd);e.success?s.value=e.content:t.lock()})()));const g=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","_","-","$","%","&","@","+","!"],f=()=>{let e="",t=g.length;for(let s=0;s<14;s++){let s=Math.floor(Math.random()*t);e+=g[s]}d(e)},m=async e=>{"lock-now"===e?(await L(s.value,t.psd),t.lock()):"change-password"===e&&t.changePassword(s.value)},S=n([{label:"立即锁定",key:"lock-now"},{label:"修改密码",key:"change-password"}]);return(e,t)=>(l(),k("div",N,[i(p(y),{type:"textarea","on-update:value":d,value:s.value,placeholder:"秘密藏在这~",style:{display:"flex",flex:"1"}},null,8,["value"]),""===s.value?(l(),u(p(v),{key:0,circle:"",style:{position:"absolute",right:"5px",bottom:"5px"},onClick:f},{default:c((()=>[T])),_:1})):h("",!0),i(p(x),{trigger:"click",onSelect:m,options:S.value,placement:"bottom-end"},{default:c((()=>[i(p(v),{circle:"",style:{position:"absolute",right:"5px",top:"5px"}},{default:c((()=>[E])),_:1})])),_:1},8,["options"])]))}}),D={style:{marginLeft:"10px",marginRight:"10px"}},B=S("div",{style:{marginTop:"10px",marginLeft:"20px",marginRight:"20px"}},"注意：修改密码只会修改当前块的密码，不会影响其他块！",-1),K=m("修改"),M=m("取消"),O=a({props:{unlock:{type:Function,required:!0},psd:{type:String,required:!0},content:{type:String,required:!0}},setup(e){const t=e,s=o(),a=n(""),r=async()=>{""!==a.value?(await L(t.content,a.value),t.unlock(a.value)):s.error("密码不能为空！")},m=()=>{t.unlock(t.psd)},w=e=>{a.value=e},k=e=>{"Enter"===e.key&&r()};return(e,t)=>(l(),u(p(f),{"x-gap":"12",cols:"2",style:{margin:"auto"}},{default:c((()=>[i(p(g),{span:"2"},{default:c((()=>[S("div",D,[i(p(y),{value:a.value,"on-update:value":w,placeholder:"请输入新密码",onKeyup:k},null,8,["value"])])])),_:1}),i(p(g),{span:"2"},{default:c((()=>[B])),_:1}),i(p(g),{span:"2"},{default:c((()=>[i(p(d),{justify:"space-around",style:{marginTop:"10px"}},{default:c((()=>[i(p(v),{onClick:r,ghost:"",type:"primary"},{default:c((()=>[K])),_:1}),i(p(v),{onClick:m,ghost:"",type:"error"},{default:c((()=>[M])),_:1})])),_:1})])),_:1})])),_:1}))}}),P={style:{display:"flex",flex:"1",padding:"5px"}},U=a({setup(e){const t=o(),s=n(""),a=async e=>{if(e===d.value)return;const a=await F(e);a.success?(g.value="secret-content",s.value=e,d.value=""):a.isFirst||(t.error("密码错误"),d.value=e)},r=e=>{a(e),window.sessionStorage.setItem("sy-secret-password",e),window.sessionStorage.setItem("sy-secret-password-time",(new Date).toUTCString())},i=()=>{g.value="password-input",s.value="",window.sessionStorage.removeItem("sy-secret-password"),window.sessionStorage.removeItem("sy-secret-password-time")},d=n(""),y=setInterval((()=>{const e=window.sessionStorage.getItem("sy-secret-password"),t=window.sessionStorage.getItem("sy-secret-password-time");if(null!=t&&""!=t&&""!=e&&null!=e){const s=new Date(t);(new Date).getTime()-s.getTime()>6e5?i():v("password-input")&&a(e)}else i()}),500);_((()=>{clearInterval(y)}));const g=n("password-input"),v=e=>g.value===e,f=n(""),m=e=>{g.value="change-password",f.value=e};return(e,t)=>(l(),u(p(b),{embedded:"","content-style":{height:"100vh",display:"flex"}},{default:c((()=>[S("div",P,[v("password-input")?(l(),u(C,{key:0,unlock:r,lock:i})):h("",!0),v("secret-content")?(l(),u(j,{key:1,psd:s.value,lock:i,"change-password":m},null,8,["psd"])):h("",!0),v("change-password")?(l(),u(O,{key:2,unlock:r,psd:s.value,content:f.value},null,8,["psd","content"])):h("",!0)])])),_:1}))}});I(a({setup:e=>(e,t)=>(l(),u(p(q),null,{default:c((()=>[i(U)])),_:1}))})).mount("#app");
//# sourceMappingURL=index.03ba4c6d.js.map
