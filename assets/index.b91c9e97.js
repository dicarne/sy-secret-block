import{c as R,a as M,d as D,u as G,r as v,o as V,b as Z,e as p,f as k,w as r,g as i,h as u,N as P,i as I,j as C,k as O,l as ee,m as B,n as J,F as T,p as S,q as z,s as N,t as te,v as ae,x as se,y as q,z as A,A as le,B as ue,C as oe,D as Q,E as ne,G as re,H as ce}from"./vendor.786507ef.js";const ie=function(){const l=document.createElement("link").relList;if(l&&l.supports&&l.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&e(c)}).observe(document,{childList:!0,subtree:!0});function n(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerpolicy&&(a.referrerPolicy=t.referrerpolicy),t.crossorigin==="use-credentials"?a.credentials="include":t.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function e(t){if(t.ep)return;t.ep=!0;const a=n(t);fetch(t.href,a)}};ie();async function K(h){var t;const l=R(),e=await(await fetch("/api/attr/getBlockAttrs",{method:"post",body:JSON.stringify({id:l})})).json();if(e&&e.data&&e.data["custom-data"])try{const a=M.exports.AES.decrypt(e.data["custom-data"],h).toString(M.exports.enc.Utf8),c=JSON.parse(a);return c.type=="secret-block"?{success:!0,content:c.content,type:(t=c.content_type)!=null?t:"text"}:{success:!1}}catch(a){return{success:!1}}else return{success:!1,isFirst:!0}}const $=async(h,l,n)=>{const e=R(),t={type:"secret-block",content:h,content_type:n},a=M.exports.AES.encrypt(JSON.stringify(t),l).toString(),_=await(await fetch("/api/attr/setBlockAttrs",{method:"post",body:JSON.stringify({id:e,attrs:{"custom-data":a}})})).json();(!_||_.code!=0)&&console.log("save data error",_),await(await fetch("/api/attr/getBlockAttrs",{method:"post",body:JSON.stringify({id:e})})).json()},W=()=>({head:["\u7528\u6237\u540D","\u5BC6\u7801"],body:[["",""],["",""],["",""]]}),de=N("\u89E3\u9501"),pe=D({props:{unlock:null,lock:null},setup(h){const l=h,n=G(),e=v(""),t=[{label:"\u6587\u672C",value:"text"},{label:"\u8868\u683C",value:"sheet"}],a=v("text"),c=async()=>{const d=await K(e.value);d.success?l.unlock(e.value):d.isFirst?e.value===""?n.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01"):(await $("",e.value,a.value),l.unlock(e.value)):n.error("\u5BC6\u7801\u9519\u8BEF\uFF01")},_=d=>{e.value=d},b=d=>{d.key==="Enter"&&c()},m=v(!1);return V(async()=>{const d=R(),o=await Z.getBlockAttr(d,"custom-data");o&&o.value!=""||(m.value=!0)}),(d,o)=>(p(),k(u(z),{"x-gap":"12",cols:"1 400:4",style:{margin:"auto",paddingLeft:"25px"}},{default:r(()=>[i(u(C),{span:"3"},{default:r(()=>[i(u(P),{"item-style":{margin:"10px",width:"100%"}},{default:r(()=>[i(u(I),{"on-update:value":_,placeholder:m.value?"\u8BF7\u8BBE\u7F6E\u521D\u59CB\u5BC6\u94A5":"\u8BF7\u8F93\u5165\u5BC6\u94A5",onKeyup:b,"passively-activated":"",round:"",type:"password"},null,8,["placeholder"])]),_:1})]),_:1}),i(u(C),{span:"1"},{default:r(()=>[i(u(P),{justify:"space-around","item-style":{margin:"10px"}},{default:r(()=>[i(u(O),{onClick:c,type:"primary",ghost:""},{default:r(()=>[de]),_:1})]),_:1})]),_:1}),i(u(C),{span:"3"},{default:r(()=>[m.value?(p(),k(u(P),{key:0,justify:"center"},{default:r(()=>[i(u(ee),{value:a.value,"onUpdate:value":o[0]||(o[0]=x=>a.value=x),name:"radiobuttongroup1"},{default:r(()=>[(p(),B(T,null,J(t,x=>i(u(te),{key:x.value,value:x.value,label:x.label},{default:r(()=>[N(ae(x.label),1)]),_:2},1032,["value","label"])),64))]),_:1},8,["value"])]),_:1})):S("",!0)]),_:1})]),_:1}))}}),fe=h=>{const l=v(0);return se(()=>(l.value+=1,setTimeout(()=>{l.value+=1},0),h()))},ve={style:{position:"relative",display:"flex",flex:"1"}},ye=N("\u5BC6"),he=N("\xB7\xB7\xB7"),ge=D({props:{psd:null,lock:null,changePassword:null},setup(h){const l=h,n=v(""),e=v("text"),t=q.exports.debounce(()=>$(n.value,l.psd,e.value),200),a=q.exports.throttle(()=>window.sessionStorage.setItem("sy-secret-password-time",new Date().toUTCString()),1e3),c=v(null),_=v(!1),b=()=>{const s=c.value.$refs.textareaElRef;s.scrollHeight>s.clientHeight?_.value=!0:_.value=!1},m=s=>{n.value=s,a(),t(),b()},d=()=>{n.value=JSON.stringify(o.value),a(),t()},o=v(W()),x=v(!1),y=async()=>{var f;x.value=JSON.parse((f=window.localStorage.getItem("sy-secret-batch-secret"))!=null?f:"true");const s=await K(l.psd);if(s.success){if(n.value=s.content,e.value=s.type,e.value==="sheet")try{o.value=JSON.parse(n.value)}catch(g){o.value=W()}}else l.lock();b()};V(()=>y());const w=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","_","-","$","%","&","@","+","!"],F=()=>{const s=14;let f="",g=w.length;for(let E=0;E<s;E++){let U=Math.floor(Math.random()*g);f+=w[U]}m(f)},L=async s=>{if(s==="lock-now")await $(n.value,l.psd,e.value),l.lock();else if(s==="change-password")l.changePassword(n.value,e.value);else if(s==="add-row"){const f=o.value.head.length;o.value.body.push(new Array(f).fill(""))}else s==="add-col"?(o.value.head.push(""),o.value.body.forEach(f=>f.push(""))):s==="del-row"?o.value.body.splice(o.value.body.length-1,1):s==="del-col"?(o.value.head.splice(o.value.head.length-1,1),o.value.body.forEach(f=>f.splice(f.length-1,1))):s==="disable-batch"?(window.localStorage.setItem("sy-secret-batch-secret","false"),x.value=!1):s==="enable-batch"&&(window.localStorage.setItem("sy-secret-batch-secret","true"),x.value=!0)},j=fe(()=>{var g;let s=[{label:"\u7ACB\u5373\u9501\u5B9A",key:"lock-now"},{label:"\u4FEE\u6539\u5BC6\u7801",key:"change-password"}];return e.value==="sheet"&&(s=[...s,{label:"\u589E\u52A0\u4E00\u884C",key:"add-row"},{label:"\u589E\u52A0\u4E00\u5217",key:"add-col"},{label:"\u5220\u9664\u4E00\u884C",key:"del-row"},{label:"\u5220\u9664\u4E00\u5217",key:"del-col"}]),JSON.parse((g=window.localStorage.getItem("sy-secret-batch-secret"))!=null?g:"true")?s.push({label:"\u5173\u95ED\u6279\u91CF\u89E3\u9501",key:"disable-batch"}):s.push({label:"\u5F00\u542F\u6279\u91CF\u89E3\u9501",key:"enable-batch"}),s}),H=s=>f=>{o.value.head[s]=f,d()},X=(s,f)=>g=>{o.value.body[s][f]=g,d()};return(s,f)=>(p(),B("div",ve,[e.value==="text"?(p(),k(u(I),{key:0,ref:(g,E)=>{E.inputRef=g,c.value=g},type:"textarea","on-update:value":m,value:n.value,placeholder:"\u79D8\u5BC6\u85CF\u5728\u8FD9~",style:{display:"flex",flex:"1","--padding-right":"0px"}},null,8,["value"])):S("",!0),e.value==="sheet"?(p(),k(u(le),{key:1,bordered:!1,"single-line":!1},{default:r(()=>[A("thead",null,[A("tr",null,[(p(!0),B(T,null,J(o.value.head,(g,E)=>(p(),B("th",null,[i(u(I),{value:g,"on-update:value":H(E)},null,8,["value","on-update:value"])]))),256))])]),A("tbody",null,[(p(!0),B(T,null,J(o.value.body,(g,E)=>(p(),B("tr",null,[(p(!0),B(T,null,J(g,(U,Y)=>(p(),B("td",null,[i(u(I),{value:U,"on-update:value":X(E,Y),placeholder:"... ..."},null,8,["value","on-update:value"])]))),256))]))),256))])]),_:1})):S("",!0),n.value===""?(p(),k(u(O),{key:2,circle:"",style:{position:"absolute",right:"5px",bottom:"5px"},onClick:F},{default:r(()=>[ye]),_:1})):S("",!0),i(u(oe),{trigger:"click",onSelect:L,options:u(j),placement:"bottom-end"},{default:r(()=>[i(u(O),{circle:"",style:ue({position:"absolute",right:_.value?"20px":"5px",top:"5px",backgroundColor:"white"}),size:"small"},{default:r(()=>[he]),_:1},8,["style"])]),_:1},8,["options"])]))}}),_e={style:{marginLeft:"10px",marginRight:"10px"}},me=A("div",{style:{marginTop:"10px",marginLeft:"20px",marginRight:"20px"}},"\u6CE8\u610F\uFF1A\u4FEE\u6539\u5BC6\u7801\u53EA\u4F1A\u4FEE\u6539\u5F53\u524D\u5757\u7684\u5BC6\u7801\uFF0C\u4E0D\u4F1A\u5F71\u54CD\u5176\u4ED6\u5757\uFF01",-1),we=N("\u4FEE\u6539"),be=N("\u53D6\u6D88"),xe=D({props:{unlock:null,psd:null,content:null,type:null},setup(h){const l=h,n=G(),e=v(""),t=v(!1),a=v(null),c=async()=>{if(e.value===""){n.error("\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A\uFF01");return}t.value=!0,await $(l.content,e.value,l.type),l.unlock(e.value,!1)};Q(()=>{a.value!=null&&clearInterval(a.value)});const _=()=>{l.unlock(l.psd)},b=d=>{e.value=d},m=d=>{d.key==="Enter"&&c()};return(d,o)=>(p(),k(u(z),{"x-gap":"12",cols:"2",style:{margin:"auto"}},{default:r(()=>[i(u(C),{span:"2"},{default:r(()=>[A("div",_e,[i(u(I),{value:e.value,"on-update:value":b,placeholder:"\u8BF7\u8F93\u5165\u65B0\u5BC6\u7801",onKeyup:m},null,8,["value"])])]),_:1}),i(u(C),{span:"2"},{default:r(()=>[me]),_:1}),i(u(C),{span:"2"},{default:r(()=>[i(u(P),{justify:"space-around",style:{marginTop:"10px"}},{default:r(()=>[i(u(O),{disabled:t.value,onClick:c,ghost:"",type:"primary"},{default:r(()=>[we]),_:1},8,["disabled"]),i(u(O),{disabled:t.value,onClick:_,ghost:"",type:"error"},{default:r(()=>[be]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1}))}});const ke={style:{display:"flex",flex:"1",padding:"5px"}},Fe=D({setup(h){const l=G(),n=v(""),e=async(y,w)=>{if(y===c.value)return;const F=await K(y);F.success?(b.value="secret-content",n.value=y,c.value=""):F.isFirst||(w!=!1&&l.error("\u5BC6\u7801\u9519\u8BEF"),c.value=y)},t=async(y,w)=>{await e(y,w),window.sessionStorage.setItem("sy-secret-password",y),window.sessionStorage.setItem("sy-secret-password-time",new Date().toUTCString())},a=()=>{b.value="password-input",n.value="",window.sessionStorage.removeItem("sy-secret-password"),window.sessionStorage.removeItem("sy-secret-password-time")},c=v(""),_=setInterval(()=>{var L;const y=JSON.parse((L=window.localStorage.getItem("sy-secret-batch-secret"))!=null?L:"true"),w=window.sessionStorage.getItem("sy-secret-password"),F=window.sessionStorage.getItem("sy-secret-password-time");if(F!=null&&F!=""&&w!=""&&w!=null){const j=new Date(F);if(new Date().getTime()-j.getTime()>1e3*60*10)a();else if(m("password-input")){if(!y)return;e(w)}}else a()},500);Q(()=>{clearInterval(_)});const b=v("password-input"),m=y=>b.value===y,d=v(""),o=v("text"),x=(y,w)=>{b.value="change-password",d.value=y,o.value=w};return(y,w)=>(p(),k(u(ne),{embedded:"","content-style":{height:"100vh",display:"flex"}},{default:r(()=>[A("div",ke,[m("password-input")?(p(),k(pe,{key:0,unlock:t,lock:a})):S("",!0),m("secret-content")?(p(),k(ge,{key:1,psd:n.value,lock:a,"change-password":x},null,8,["psd"])):S("",!0),m("change-password")?(p(),k(xe,{key:2,unlock:t,psd:n.value,content:d.value,type:o.value},null,8,["psd","content","type"])):S("",!0)])]),_:1}))}}),Ee=D({setup(h){return(l,n)=>(p(),k(u(re),null,{default:r(()=>[i(Fe)]),_:1}))}});ce(Ee).mount("#app");
//# sourceMappingURL=index.b91c9e97.js.map
