import{d as e,u as t,r as s,o as a,c as o,a as n,b as r,e as l,w as c,f as i,g as u,N as p,h as d,i as y,j as g,k as f,l as v,A as m,m as w,n as k,p as h,q as x,s as S,t as _,v as b,x as q,y as I,z as A}from"./vendor.edc720a2.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const s of e)if("childList"===s.type)for(const e of s.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const N=v("解锁"),L=e({props:{unlock:{type:Function,required:!0},lock:{type:Function,required:!0}},setup(e){const v=e,k=t(),h=s(""),x=async()=>{const e=o(),t=await n.getBlockAttr(e,"custom-data");if(t&&""!=t.value)try{const e=m.decrypt(t.value,h.value).toString(w.exports.enc.Utf8);"secret-block"==JSON.parse(e).type?v.unlock(h.value):k.error("密码错误！")}catch(s){k.error("密码错误！")}else v.unlock(h.value)},S=e=>{h.value=e},_=e=>{"Enter"===e.key&&x()},b=s(!1);return a((async()=>{const e=o(),t=await n.getBlockAttr(e,"custom-data");t&&""!=t.value||(b.value=!0)})),(e,t)=>(r(),l(u(f),{"x-gap":"12",cols:"1 400:4",style:{margin:"auto",paddingLeft:"25px"}},{default:c((()=>[i(u(y),{span:"3"},{default:c((()=>[i(u(p),{"item-style":{margin:"10px",width:"100%"}},{default:c((()=>[i(u(d),{"on-update:value":S,placeholder:b.value?"请设置初始密钥":"请输入密钥",onKeyup:_,"passively-activated":"",round:"",type:"password"},null,8,["placeholder"])])),_:1})])),_:1}),i(u(y),{span:"1"},{default:c((()=>[i(u(p),{justify:"space-around","item-style":{margin:"10px"}},{default:c((()=>[i(u(g),{onClick:x,type:"primary",ghost:""},{default:c((()=>[N])),_:1})])),_:1})])),_:1})])),_:1}))}}),C={style:{position:"relative",display:"flex",flex:"1"}},T=v("密"),B=v("···"),F=e({props:{psd:{type:String,required:!0},lock:{type:Function,required:!0},changePassword:{type:Function,required:!0}},setup(e){const t=e,p=s(""),y=k.exports.debounce((async()=>{const e=o(),s={type:"secret-block",content:p.value},a=m.encrypt(JSON.stringify(s),t.psd).toString();await n.setBlockAttrs({id:e,attrs:{"custom-data":a}})}),200),f=k.exports.throttle((()=>window.sessionStorage.setItem("sy-secret-password-time",(new Date).toUTCString())),1e3),v=e=>{p.value=e,f(),y()};a((()=>(async()=>{const e=o(),s=await n.getBlockAttr(e,"custom-data");if(s&&""!=s.value){const e=m.decrypt(s.value,t.psd).toString(w.exports.enc.Utf8);try{const t=JSON.parse(e);"secret-block"==t.type&&(p.value=t.content)}catch(a){}}})()));const _=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","0","1","2","3","4","5","6","7","8","9","_","-","$","%","&","@","+","!"],b=()=>{let e="",t=_.length;for(let s=0;s<14;s++){let s=Math.floor(Math.random()*t);e+=_[s]}v(e)},q=e=>{"lock-now"===e?t.lock():"change-password"===e&&t.changePassword(p.value)},I=s([{label:"立即锁定",key:"lock-now"},{label:"修改密码",key:"change-password"}]);return(e,t)=>(r(),h("div",C,[i(u(d),{type:"textarea","on-update:value":v,value:p.value,placeholder:"秘密藏在这~",style:{display:"flex",flex:"1"}},null,8,["value"]),""===p.value?(r(),l(u(g),{key:0,circle:"",style:{position:"absolute",right:"5px",bottom:"5px"},onClick:b},{default:c((()=>[T])),_:1})):x("",!0),i(u(S),{trigger:"click",onSelect:q,options:I.value,placement:"bottom-end"},{default:c((()=>[i(u(g),{circle:"",style:{position:"absolute",right:"5px",top:"5px"}},{default:c((()=>[B])),_:1})])),_:1},8,["options"])]))}}),O={style:{marginLeft:"10px",marginRight:"10px"}},j=_("div",{style:{marginTop:"10px",marginLeft:"20px",marginRight:"20px"}},"注意：修改密码只会修改当前块的密码，不会影响其他块！",-1),D=v("修改"),E=v("取消"),J=e({props:{unlock:{type:Function,required:!0},psd:{type:String,required:!0},content:{type:String,required:!0}},setup(e){const a=e,v=t(),m=s(""),k=async()=>{""!==m.value?(await(async()=>{const e=o(),t={type:"secret-block",content:a.content},s=w.exports.AES.encrypt(JSON.stringify(t),m.value).toString();await n.setBlockAttrs({id:e,attrs:{"custom-data":s}})})(),a.unlock(m.value)):v.error("密码不能为空！")},h=()=>{a.unlock(a.psd)},x=e=>{m.value=e},S=e=>{"Enter"===e.key&&k()};return(e,t)=>(r(),l(u(f),{"x-gap":"12",cols:"2",style:{margin:"auto"}},{default:c((()=>[i(u(y),{span:"2"},{default:c((()=>[_("div",O,[i(u(d),{value:m.value,"on-update:value":x,placeholder:"请输入新密码",onKeyup:S},null,8,["value"])])])),_:1}),i(u(y),{span:"2"},{default:c((()=>[j])),_:1}),i(u(y),{span:"2"},{default:c((()=>[i(u(p),{justify:"space-around",style:{marginTop:"10px"}},{default:c((()=>[i(u(g),{onClick:k,ghost:"",type:"primary"},{default:c((()=>[D])),_:1}),i(u(g),{onClick:h,ghost:"",type:"error"},{default:c((()=>[E])),_:1})])),_:1})])),_:1})])),_:1}))}}),U={style:{display:"flex",flex:"1",padding:"5px"}};A(e({setup(e){const t=s(""),a=e=>{d.value="secret-content",t.value=e},o=e=>{a(e),window.sessionStorage.setItem("sy-secret-password",e),window.sessionStorage.setItem("sy-secret-password-time",(new Date).toUTCString())},n=()=>{d.value="password-input",t.value="",window.sessionStorage.removeItem("sy-secret-password"),window.sessionStorage.removeItem("sy-secret-password-time")},p=setInterval((()=>{const e=window.sessionStorage.getItem("sy-secret-password"),t=window.sessionStorage.getItem("sy-secret-password-time");if(null!=t&&""!=t&&""!=e&&null!=e){const s=new Date(t);(new Date).getTime()-s.getTime()>6e5?n():y("password-input")&&a(e)}else n()}),500);b((()=>{clearInterval(p)}));const d=s("password-input"),y=e=>d.value===e,g=s(""),f=e=>{d.value="change-password",g.value=e};return(e,s)=>(r(),l(u(I),null,{default:c((()=>[i(u(q),{embedded:"","content-style":{height:"100vh",display:"flex"}},{default:c((()=>[_("div",U,[y("password-input")?(r(),l(L,{key:0,unlock:o,lock:n})):x("",!0),y("secret-content")?(r(),l(F,{key:1,psd:t.value,lock:n,"change-password":f},null,8,["psd"])):x("",!0),y("change-password")?(r(),l(J,{key:2,unlock:o,psd:t.value,content:g.value},null,8,["psd","content"])):x("",!0)])])),_:1})])),_:1}))}})).mount("#app");
//# sourceMappingURL=index.88b1e170.js.map
